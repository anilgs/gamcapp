packages:
  yum:
    postgresql15: []
    postgresql15-devel: []

option_settings:
  aws:elasticbeanstalk:application:environment:
    NPM_CONFIG_PRODUCTION: false
  aws:elasticbeanstalk:container:nodejs:
    NodeCommand: "npm start"
    NodeVersion: 18.19.0
  aws:elasticbeanstalk:environment:proxy:staticfiles:
    /static: public
    /uploads: uploads
  aws:elasticbeanstalk:environment:proxy:
    ProxyServer: nginx
  aws:elasticbeanstalk:healthreporting:system:
    SystemType: enhanced
    HealthCheckSuccessThreshold: Ok
    HealthCheckURL: /api/health

files:
  "/opt/elasticbeanstalk/hooks/appdeploy/post/01_install_dependencies.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      cd /var/app/current
      npm ci --production
      
  "/opt/elasticbeanstalk/hooks/appdeploy/post/02_create_directories.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      mkdir -p /var/app/current/uploads
      chown webapp:webapp /var/app/current/uploads
      chmod 755 /var/app/current/uploads

container_commands:
  01_node_install:
    command: |
      curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
      export NVM_DIR="/root/.nvm"
      [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
      nvm install 18.19.0
      nvm use 18.19.0
      nvm alias default 18.19.0
    ignoreErrors: false